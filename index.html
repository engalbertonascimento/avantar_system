<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avantar - Cadastro de Contatos</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding: 20px; }
        .form-container { background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 100%; max-width: 700px; }
        .form-group { margin-bottom: 15px; }
        .row { display: flex; gap: 15px; margin-bottom: 15px; }
        .row > div { flex: 1; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        input[readonly] { background-color: #f9f9f9; color: #666; cursor: not-allowed; }
        button { background: #004a8d; color: white; padding: 12px; border: none; border-radius: 4px; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        button:hover { background: #003566; }
        #mensagem { margin-top: 15px; padding: 10px; border-radius: 4px; display: none; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

<div class="form-container">
    <h2>Novo Cadastro de Contato - Avantar</h2>
    <form id="formContato">
        
        <div class="form-group">
            <label>Nome Completo do Cliente *</label>
            <input type="text" name="nome_cliente" required placeholder="Ex: Joziel Pereira">
        </div>

        <div class="row">
            <div class="form-group">
                <label>CNPJ</label>
                <input type="text" name="cnpj" placeholder="00.000.000/0001-00">
            </div>
            <div class="form-group">
                <label>Final do Telefone</label>
                <input type="text" name="final_telefone" maxlength="4" placeholder="Ex: 1234">
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <label>Status da Tentativa</label>
                <select name="status_contato">
                    <option value="Novo">Novo</option>
                    <option value="Contato realizado">Contato realizado</option>
                    <option value="Contato sem êxito">Contato sem êxito</option>
                    <option value="Incompleto">Incompleto</option>
                    <option value="Cliente desistiu">Cliente desistiu</option>
                </select>
            </div>
            <div class="form-group">
                <label>Operadora</label>
                <input type="text" name="operadora" placeholder="Amil, Bradesco, etc.">
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <label>Quantas Vidas?</label>
                <input type="number" name="qtd_vidas" placeholder="Qtd. Colaboradores">
            </div>
            <div class="form-group">
                <label>Valor da Cotação (R$)</label>
                <input type="number" step="0.01" name="valor_cotacao" placeholder="0.00">
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <label>Data do 1º Contato</label>
                <input type="date" name="data_primeiro_contato" id="data_primeiro" onchange="calcularRetorno()" required>
            </div>
            <div class="form-group">
                <label>Retorno Previsto (+3 dias)</label>
                <input type="date" name="data_retorno_prevista" id="data_retorno" readonly>
            </div>
        </div>

        <div class="form-group">
            <label>Data Solicitada pelo Cliente (Opcional)</label>
            <input type="date" name="data_solicitada_cliente">
        </div>

        <div class="form-group">
            <label>Observações</label>
            <textarea name="observacoes" rows="3" placeholder="Detalhes da conversa..."></textarea>
        </div>

        <button type="submit" id="btnSalvar">Salvar Contato no Sistema</button>
        <div id="mensagem"></div>
    </form>
</div>

<script>
// Função para automatizar a regra de negócio dos 3 dias
function calcularRetorno() {
    const dataInicio = document.getElementById('data_primeiro').value;
    if (dataInicio) {
        let data = new Date(dataInicio);
        // Adiciona 3 dias corridos
        data.setDate(data.getDate() + 3);
        
        // Ajusta para o formato YYYY-MM-DD que o input date aceita
        const ano = data.getFullYear();
        const mes = String(data.getMonth() + 1).padStart(2, '0');
        const dia = String(data.getDate() + 1).padStart(2, '0'); // +1 correção de fuso do objeto Date
        
        document.getElementById('data_retorno').value = `${ano}-${mes}-${dia}`;
    }
}

document.getElementById('formContato').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const btn = document.getElementById('btnSalvar');
    const msgDiv = document.getElementById('mensagem');
    
    btn.disabled = true;
    btn.innerText = 'Processando...';

    const dados = new FormData(this);

    fetch('actions/salvar_contato.php', {
        method: 'POST',
        body: dados
    })
    .then(response => response.json())
    .then(res => {
        msgDiv.style.display = 'block';
        msgDiv.innerText = res.message;
        msgDiv.style.backgroundColor = res.status === 'success' ? '#d4edda' : '#f8d7da';
        msgDiv.style.color = res.status === 'success' ? '#155724' : '#721c24';

        if(res.status === 'success') {
            this.reset();
            document.getElementById('data_retorno').value = '';
        }
    })
    .catch(err => {
        console.error('Erro:', err);
        alert('Erro ao conectar com a pasta actions.');
    })
    .finally(() => {
        btn.disabled = false;
        btn.innerText = 'Salvar Contato no Sistema';
    });
});
</script>

</body>
</html>